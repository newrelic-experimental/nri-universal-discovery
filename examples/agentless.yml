---
discovery:
  ttl: 1m
  command:
    exec: /root/nri-universal-discovery
    env:
      NR_ACCOUNT_ID: "2676709"
      NR_API_KEY: "NRAK-XXXXXX"
      NR_QUERY: "SELECT \
        latest(datacenterName) as 'dcName', \
        latest(vmConfigName) as 'vmName', \
        latest(vmHostname) as 'vmHostname' \
        FROM VSphereVmSample FACET entityName LIMIT MAX"
      NR_DECORATOR_FILE: "/root/decorations.json"
    match:
      vmName: /\S+/
integrations:
  - name: nri-flex
    interval: 1m
    env:
      CONFIG_FILE: /etc/newrelic-infra/integrations.d/configs/netstat.yml
      ALLOW_ENV_COMMANDS: true
      FLEX_META: ${discovery.flexMeta}
      FLEX_CMD_PREPEND: "set +H && \
        govc guest.run -k \
        -u \"https://${discovery.dcUser}:${discovery.dcPass}@192.168.0.210\" \
        -dc \"${discovery.dcName}\" \
        -k -vm \"${discovery.vmName}\" \
        -l \"${discovery.guestUser}:${discovery.guestPass}\""
